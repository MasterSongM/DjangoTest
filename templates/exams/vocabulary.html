<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
	<title>Title</title>

</head>
<body>
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<div class="outer">
	<div class="upper">
		<div class="" style="filter:alpha(Opacity=90);-moz-opacity:0.9;opacity: 0.9;">
			<img src="/static/images/playing.png" style="max-width: 20%; max-height: 20%; float: left; margin-left: 10%; animation: playing 2.5s infinite;">
		</div>

	</div>

	<div class=" downer">
		<div>
			<img src="/static/images/boy.png" style="width: 30%; height: 70%; float: right; margin-right: -5%; margin-top: 9%; animation: playing 4s infinite;">
		</div>
		<div id="choose" class="animate__animated">
			<div class="duck_container">
				<div class="ducks" id="duck1" onclick="">
					<img class="duck-in" src="/static/images/yellow_duck.png" style="opacity: 0">
					<img class="words" src=" " style="opacity: 0">
					<div class="flag"></div>
					<div class="item_id"></div>
					<img class="res yes" src='/static/images/yes3.png' style="display: none">
					<img class="res nope" src='/static/images/nope.jpg' style="display: none">
				</div>
				<div></div>
			</div>
			<div class="duck_container">
				<div class="ducks" id="duck2">
					<img class="duck-in" src="/static/images/yellow_duck.png"  style="opacity: 0">
					<img class="words" src=" " style="opacity: 0">
					<div class="flag"></div>
					<div class="item_id"></div>
					<img class="res yes" src='/static/images/yes3.png' style="display: none">
					<img class="res nope" src='/static/images/nope.jpg' style="display: none">
				</div>
			</div>
			<div class="duck_container">
				<div class="ducks" id="duck3"  onclick="">
					<img class="duck-in" src="/static/images/yellow_duck.png" style="opacity: 0">
					<img class="words" src=" " style="opacity: 0">
					<div class="flag"></div>
					<div class="item_id"></div>
					<img class="res yes" src='/static/images/yes3.png' style="display: none">
					<img class="res nope" src='/static/images/nope.jpg' style="display: none">
				</div>
				<div></div>
			</div>

		</div>

	</div>
	<div id="guiding">
		<h1>指导语</h1>
		<img id="t1">
		<img id="t2">
		<p style="display: none" id="item">{{ items }}</p>
	<br>
		<b>测试过程中请勿刷新或者关闭本页面</b>
		<div class="clear"></div>
		<button class="btn-success btn-lg" onclick="start_test()">我明白了，开始测试</button>
	</div>
	<div id="ending" style="display: none">
		<h1>测试结束</h1>
		<b>正在提交结果，请稍候……</b><br>
		<b>测试已经提交完成，感谢您的参与！</b><br>
		<div class="clear">
			<a class="btn" href="../index">
				<button type="button" class="btn btn-lg btn-info">回到首页>></button>
			</a>
			<a class="btn" href="../examination">
				<button type="button" class="btn btn-lg btn-info">其他测试>></button>
			</a>
		</div>
	</div>

	<div class="" style="position: absolute; left: 0; top: 0">
			<a class="btn" href="#modal-container-113904" role="button" class="btn" data-toggle="modal">
				<button type="button" class="btn btn-warning" >回到首页</button></a>
		</div>

	<div class="" style="position: absolute; right: 0; bottom: 0">
				 <a id="modal-113904" href="#modal-container-113904" role="button" class="btn" data-toggle="modal">
					<button type="button" class="btn btn-warning">中止测验</button>
				 </a>

				<div class="modal fade" id="modal-container-113904" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
								<h4 class="modal-title" id="myModalLabel">
									确认退出吗？
								</h4>
							</div>
							<div class="modal-body">
								如果游戏已经结束，或者你要中止游戏，请点击确认退出~
							</div>
							<div class="modal-footer">
								<a class="btn" href="http://127.0.0.1:8000/index/">
									<button type="button" class="btn btn-default">确认退出</button></a>
								<button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>

							</div>
						</div>

					</div>

				</div>

			</div>
</div>
</body>
<style type="text/css">
	html, body { height: 100%; padding: 0; margin: 0; overflow:hidden}
	body {
		{#background-image:url('/static/images/swimming_pool.jpg');#}
		background-image:url('/static/images/swimming_pool.jpg');
		background-repeat:no-repeat;
		background-attachment:fixed;
		background-position:center;
		background-size:100% 100%;
	}
	.outer { height: 100%; padding: 100px 0 0; box-sizing: border-box ; position: relative; text-align: center}
	.upper { width: 100%; height: 25%;  position: absolute; top: 0 ; left: 0 ;
		border: 20px solid #46b8da; border-bottom: 0}
	.downer { width: 100%; height: 75%;  top:25%; bottom: 0;position: absolute;
		border: 20px solid #46b8da; border-top: 0}

	#guiding,#ending {
		z-index: 2;
		height: 60%;
		width: 60%;
		border: 10px solid #46b8da;;
		position: fixed;
		top: 10%;
		left: 20%;
		text-align: center;
	}

	.duck_container{
		display: flex;
		flex-direction: row;
		margin-bottom: -2%;
	}
	.ducks {
		cursor: pointer;
		display: flex;
		position: relative;
		width: 18%;
		height:18%;
		float: left;
		left: 15%;
	}
	.ducks .flag,.item_id{
		display: none;
	}

	.ducks img{
		animation: swim 2s infinite;
		display: inline;
		clear:both;
		width:100%;
		height:15%;
		float: left;
	}
	.ducks .words{
		position: absolute;
		animation: none;
		height:40%;width: 45%;
		left:30%;top:45%;
		text-align: center;
		font-size: 24px;
	}
	.ducks .res{
		width:60%;
		height:12%;
	}

	@keyframes myMove
	{
		10%   {left:15%; }
		100% {left:90%;}
	}

	@keyframes swim {
		0%,100%{ transform: rotate(-8deg) translateY(0);  }
		50%{  transform: rotate(8deg) translateY(-10px);  }
}
	@keyframes playing {
		0%,100%{ transform: rotate(-4deg) translateY(0);  }
		50%{  transform: rotate(4deg) translateY(-6px);  }
}
	@keyframes myRotateIn {
		0% {
        -webkit-transform: rotate(-45deg);
        transform: rotate(-45deg);
        opacity: 0.5
    }
    to {
        -webkit-transform: translateZ(10px);
        transform: translateZ(10px);
        opacity: 1
    }
}

</style>
<script>
	let items
	let test_results
	let next = 0
	let total_items = 0
	let free = ""
	$(document).ready(function(){
	  	let json_text = $("#item").text()
		items = $.parseJSON(json_text)
		total_items = items.length
		console.log(total_items)
		console.log("items:",items)
		$("#t1").attr("src",items[0].image)
		$("#t2").attr("src",items[1].image)
	});
	
	function start_test() {
	    free = "#duck2"
	    $("#guiding").css("display", "none")
	    function wait(secs){
				setTimeout(function () {
					swim($("#duck1"))
				}, secs);
			}
	    console.log("swimming start!")
		swim($("#duck3"))
		wait(1000)
    }

    function swim(dom){
	    //给子节点写入相关信息
		$(dom).children(".words").attr("src", items[next].image)
		$(dom).children(".flag").text(items[next].flag)
		$(dom).children(".item_id").text(items[next].id)

		//显示节点，添加动画和点击触发的函数
	    $(dom).children(".duck-in").css("opacity","1")
		$(dom).children(".words").css("opacity","1")
		$(dom).css("animation","myMove 8s linear forwards")
	    $(dom).attr("onclick","get_answer(this, true)")

		//动画结束未点击，触发get_answer()
		$(dom).one('animationend',function () {
		    {#get_answer()#}
			$(dom).attr("onclick","")
			console.log("answer_nope!")
			get_answer(this, false)
        })

	    next += 1
	}
	
	function get_answer(obj, clicked) {
	    $(obj).unbind()		//移除绑定事件
		$(obj).attr("onclick","")	//移除点击事件
	    console.log(obj.id)

		//判断正误并反馈
		let flag = Boolean($(obj).children(".flag").text())
		console.log(flag, clicked)
		if(flag & clicked){
		    answer_yes(obj)
		}else{
		    answer_nope(obj)
		}
		if(next < total_items){
		    swim(free)
			free = obj.id
		}else{
		    end_test()
		}
	}
	
	function answer_yes(obj) {
        //停止动画并保留当前位置
		$(obj).css("animation-play-state","paused")
		$(obj).css("left",$(obj).css("left"))

		//触发正确答案的交互效果
		$(obj).children(".yes").css({"display":"inline","animation":"myRotateIn 1.5s forwards"})
		$(obj).children(".yes").one('animationend',function () {
		    console.log("animationend!")
			duck_reset(obj)
        })

		//保留题目id及作答结果
		let tested_id = parseInt($(obj).children(".item_id").text())
		console.log("result:",tested_id, true)
	}
	
	function answer_nope(obj) {
	    //停止动画并保留当前位置
		$(obj).css("animation-play-state","paused")
		$(obj).css("left",$(obj).css("left"))

		//触发错误答案的交互效果
		$(obj).children(".nope").css({"display":"inline","animation":"myRotateIn 1.5s forwards"})
		$(obj).children(".nope").one('animationend',function () {
		    console.log("animationend!")
			duck_reset(obj)
        })

		//保留题目id及作答结果
		let tested_id = parseInt($(obj).children(".item_id").text())
		console.log("result:",tested_id, false)
	}

	function duck_reset(obj) {
	    {#new_swim()#}
	    $(obj).children(".yes").css("display", "none")
		$(obj).children(".nope").css("display", "none")
		$(obj).children(".words").css("opacity", "0")
		$(obj).children(".duck-in").css({"display": "block", "opacity": "0"})
		$(obj).css({"left": "15%", "animation":"none"})
    }

    function end_test() {
	    console.log("Test finished!")
		console.log("free:",free)
		setTimeout(function(){ $("#ending").css("display","block") }, 5000);
    }
</script>

</html>